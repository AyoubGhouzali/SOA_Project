graph TB
    subgraph USERS["ğŸ‘¥ Utilisateurs"]
        WEB[ğŸŒ Application Web<br/>React/Vue.js<br/>Port 3000]
        BUSUI[ğŸ–¥ï¸ Interface Bus<br/>Web embarquÃ©e<br/>Validation tickets]
        ADMINUI[âš™ï¸ Admin Portal<br/>Gestion systÃ¨me]
    end
    
    subgraph GATEWAY["ğŸ” Couche API"]
        APIGW[API Gateway<br/>Kong/Spring Cloud Gateway<br/>Port 8080<br/>---<br/>Routing, Auth, Rate Limiting]
    end
    
    subgraph SERVICES["âš™ï¸ Microservices"]
        USER[ğŸ‘¤ User Service<br/>Spring Boot<br/>Port 8081<br/>---<br/>Auth, Profils]
        TICKET[ğŸ« Ticketing Service<br/>Spring Boot<br/>Port 8082<br/>---<br/>Tickets, Commandes]
        SUB[ğŸ“… Subscription Service<br/>Spring Boot<br/>Port 8083<br/>---<br/>Abonnements]
        SCHED[ğŸš Scheduling Service<br/>Spring Boot<br/>Port 8084<br/>---<br/>Lignes, Horaires]
        TRACK[ğŸ“ Tracking Service<br/>Node.js<br/>Port 8085<br/>---<br/>GPS, ETA]
        NOTIF[ğŸ“¬ Notification Service<br/>Node.js<br/>Port 8086<br/>---<br/>Email, SMS, Push]
        PAY[ğŸ’° Payment Service<br/>Spring Boot<br/>Port 8087<br/>---<br/>Transactions]
    end
    
    subgraph DATA["ğŸ’¾ Bases de DonnÃ©es"]
        USERDB[(User DB<br/>PostgreSQL)]
        TICKETDB[(Ticketing DB<br/>PostgreSQL)]
        SUBDB[(Subscription DB<br/>PostgreSQL)]
        SCHEDDB[(Scheduling DB<br/>PostgreSQL)]
        TRACKDB[(Tracking DB<br/>MongoDB)]
        NOTIFDB[(Notification DB<br/>MongoDB)]
        PAYDB[(Payment DB<br/>PostgreSQL)]
    end
    
    subgraph INFRA["ğŸ”§ Infrastructure"]
        BROKER[ğŸ“¨ Message Broker<br/>Kafka/RabbitMQ<br/>Event Bus]
        CACHE[âš¡ Redis Cache<br/>Session, ETA]
        VAULT[ğŸ”’ Vault<br/>Secrets Management]
    end
    
    subgraph EXTERNAL["ğŸŒ Services Externes"]
        STRIPE[ğŸ’³ Stripe API]
        MAPS[ğŸ—ºï¸ Google Maps API]
        SMS_EXT[ğŸ“± Twilio]
        EMAIL_EXT[ğŸ“§ SendGrid]
    end
    
    WEB --> APIGW
    BUSUI --> APIGW
    ADMINUI --> APIGW
    
    APIGW --> USER
    APIGW --> TICKET
    APIGW --> SUB
    APIGW --> SCHED
    APIGW --> TRACK
    
    USER --> USERDB
    TICKET --> TICKETDB
    SUB --> SUBDB
    SCHED --> SCHEDDB
    TRACK --> TRACKDB
    NOTIF --> NOTIFDB
    PAY --> PAYDB
    
    TICKET -.->|Events| BROKER
    SUB -.->|Events| BROKER
    SCHED -.->|Events| BROKER
    TRACK -.->|Events| BROKER
    PAY -.->|Events| BROKER
    
    BROKER -.->|Subscribe| NOTIF
    BROKER -.->|Subscribe| TICKET
    BROKER -.->|Subscribe| SUB
    
    TRACK --> CACHE
    TICKET --> CACHE
    
    PAY --> STRIPE
    TRACK --> MAPS
    NOTIF --> SMS_EXT
    NOTIF --> EMAIL_EXT
    
    USER --> VAULT
    PAY --> VAULT